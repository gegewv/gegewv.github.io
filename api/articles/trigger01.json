{"title":"触发器01","slug":"trigger01","date":"2021-09-25T02:44:56.000Z","updated":"2021-09-25T02:58:59.477Z","comments":true,"path":"api/articles/trigger01.json","photos":[],"link":"","excerpt":"触发器是与表有关的数据库对象，在满足定义条件时触发，并执行触发器中定义的语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性。","covers":null,"content":"<blockquote>\n<p>触发器是与表有关的数据库对象，在满足定义条件时触发，并执行触发器中定义的语句集合。触发器的这种特性可以协助应用在数据库端确保数据的完整性。</p>\n</blockquote>\n<span id=\"more\"></span>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> DEFINER<span class=\"operator\">=</span>`codeigniter01`@`localhost`</span><br><span class=\"line\"><span class=\"keyword\">TRIGGER</span> `update_class_name`</span><br><span class=\"line\">BEFORE UPDATE <span class=\"keyword\">ON</span> `test` <span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"type\">ROW</span> <span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"><span class=\"keyword\">DECLARE</span> class_name <span class=\"type\">VARCHAR</span>(<span class=\"number\">20</span>) <span class=\"keyword\">DEFAULT</span> <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">set</span> class_name <span class=\"operator\">=</span> (<span class=\"keyword\">SELECT</span> class <span class=\"keyword\">from</span> `class` <span class=\"keyword\">where</span> id<span class=\"operator\">=</span>new.class_id);</span><br><span class=\"line\"><span class=\"keyword\">set</span> new.class_name<span class=\"operator\">=</span>class_name;</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>在 <code>test</code> 表更新前触发，根据 <code>class_id</code> 到 <code>class</code> 表中查询 <code>class</code> 字段，更新到 <code>test</code> 表中的 <code>class_name</code></p>\n</blockquote>\n<ul>\n<li>如果触发的操作是修改本表数据时，修改需要用一下语句，否则会造成循环调用：</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">set</span> new.class_name<span class=\"operator\">=</span><span class=\"string\">&#x27;A班&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>修改其他表数据时的语句：</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update `表名` <span class=\"keyword\">set</span> NEW.列名 <span class=\"operator\">=</span> <span class=\"string\">&#x27;列值&#x27;</span> <span class=\"keyword\">where</span> <span class=\"string\">&#x27;条件&#x27;</span>;</span><br></pre></td></tr></table></figure>\n","categories":[],"tags":[{"name":"mysql","slug":"mysql","count":1,"path":"api/tags/mysql.json"}]}